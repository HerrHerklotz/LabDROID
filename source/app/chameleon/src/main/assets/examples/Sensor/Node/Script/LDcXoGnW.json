{"inputs":[["component","hw_sensor_Accelerometer","Data","stream"],["component","hw_sensor_Gyroscope","Data","stream"]],"label":"ComplementaryFilter","outputs":[null],"position":{"x":211,"y":325},"typeName":"node/script","code":"const convert = 180/Math.PI\r\n\r\nlet start\r\nlet end = $now()\r\nlet prevAngle = 0\r\n\r\nwhile (true) {\r\n    start = end\r\n    end = $now()\r\n    const dT = (end - start)/1000000000\r\n    \r\n    const accel = $receive(0)\r\n    const accelAngle = 0-Math.atan2(accel.x, Math.sqrt( accel.y * accel.y + accel.z * accel.z))*convert\r\n    \r\n    const gyro = $receive(1)\r\n    const gyroAngle = gyro.y*convert*dT\r\n        \r\n    const angle = (0.996 * (prevAngle + gyroAngle)) + (0.004*accelAngle)\r\n    \r\n    $out(0, angle)\r\n    \r\n    prevAngle = angle\r\n}"}